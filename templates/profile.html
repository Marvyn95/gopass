{% extends "base.html" %}
{% block content %}
<div class="container my-1">
  <!-- Header Section -->
  <div class="row mb-2">
    <div class="col-12">
      <div class="d-flex align-items-center mb-4">
        <i class="bi bi-person-circle fs-2 me-3 text-primary"></i>
        <h2 class="fw-bold mb-0 text-light" style="background: linear-gradient(90deg, #8ec5ff, #3b82f6, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;">
          Profile Information
        </h2>
      </div>
    </div>
  </div>

  <!-- Main Profile Info Cards -->
  <div class="row mb-3">
    <div class="col-md-6 col-lg-3 mb-4">
      <div class="card bg-dark border-0 h-100">
        <div class="card-body">
          <div class="mb-3">
            <i class="bi bi-person-fill text-primary fs-5"></i>
          </div>
          <p class="text-light small mb-2">Full Name</p>
          <p class="text-light fw-bold">{{ user.first_name }} {{ user.last_name }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card bg-dark border-0 h-100">
        <div class="card-body">
          <div class="mb-3">
            <i class="bi bi-envelope-fill text-primary fs-5"></i>
          </div>
          <p class="text-light small mb-2">Email Address</p>
          <p class="text-light fw-bold text-break">{{ user.email }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-4">
      <div class="card bg-dark border-0 h-100">
        <div class="card-body">
          <div class="mb-3">
            <i class="bi bi-telephone-fill text-primary fs-5"></i>
          </div>
          <p class="text-light small mb-2">Contact Number</p>
          <p class="text-light fw-bold">{{ user.contact }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-4">
      <div class="card bg-dark border-0 h-100">
        <div class="card-body">
          <div class="mb-3">
            <i class="bi bi-geo-alt-fill text-primary fs-5"></i>
          </div>
          <p class="text-light small mb-2">Role</p>
          <p class="text-light fw-bold">{{ user.role }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Organization Info -->
  <div class="row mb-5">
    <div class="col-lg-8">
      <div class="card bg-dark border-0">
        <div class="card-body">
          <div class="d-flex align-items-center mb-4">
            <i class="bi bi-building text-primary fs-4 me-2"></i>
            <h5 class="fw-bold mb-0 text-light">Organization</h5>
          </div>
          <p class="text-light mb-0">{{ org.name }}</p>
        </div>
      </div>
    </div>

    <!-- Quick Actions (Right Side) -->
    <div class="col-lg-4">
      <div class="d-flex flex-column gap-2">
        <button type="button" class="btn btn-outline-primary btn-sm w-50" data-bs-toggle="modal" data-bs-target="#editProfileModal" style="background: linear-gradient(90deg, #8ec5ff, #3b82f6, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;">
          <i class="bi bi-pencil-square me-2"></i> Edit Profile
        </button>
        <button type="button" class="btn btn-outline-primary btn-sm w-50" data-bs-toggle="modal" data-bs-target="#changePasswordModal" style="background: linear-gradient(90deg, #8ec5ff, #3b82f6, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;">
          <i class="bi bi-key me-2"></i> Change Password
        </button>
        {% if user and user.role == 'admin' %}
        <button type="button" class="btn btn-outline-primary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#addOrganizationModal" style="background: linear-gradient(90deg, #8ec5ff, #3b82f6, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;">
          <i class="bi bi-building-add me-2"></i> Add Organization
        </button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Admin Section -->
  {% if user and user.role in ['admin', 'manager'] %}
  <div class="row mb-5">
    <div class="col-12">
      <h5 class="fw-bold mb-3" style="background: linear-gradient(90deg, #8ec5ff, #3b82f6, #ec4899); -webkit-background-clip: text; background-clip: text; color: transparent; -webkit-text-fill-color: transparent;">Management</h5>
    </div>
    <div class="col-md-6 col-lg-4 mb-4">
      <a href="{{ url_for('manage_users') }}" class="btn btn-dark border border-primary w-100 text-start py-3">
        <i class="bi bi-people text-primary me-3"></i>
        <span class="text-light">Manage Users</span>
      </a>
    </div>
    <div class="col-md-6 col-lg-4 mb-4">
      <a href="{{ url_for('create_event') }}" class="btn btn-dark border border-primary w-100 text-start py-3">
        <i class="bi bi-calendar-plus text-primary me-3"></i>
        <span class="text-light">Create Event</span>
      </a>
    </div>
    <div class="col-md-6 col-lg-4 mb-4">
      <a href="{{ url_for('manage_events') }}" class="btn btn-dark border border-primary w-100 text-start py-3">
        <i class="bi bi-calendar-check text-primary me-3"></i>
        <span class="text-light">Manage Events</span>
      </a>
    </div>
  </div>
  {% endif %}
</div>

<!-- Modals -->
<!-- Add Organization Modal -->
<div class="modal fade" id="addOrganizationModal" tabindex="-1" aria-labelledby="addOrganizationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border-0">
      <form method="POST" action="{{ url_for('add_organization') }}">
        <div class="modal-header border-0">
          <h5 class="modal-title text-light" id="addOrganizationModalLabel">Add Organization Details</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6 class="mb-3 text-light">Organization Details</h6>
          <div class="mb-3">
            <input type="text" class="form-control" name="org_name" placeholder="Organization/Business Name" required>
          </div>
          <div class="mb-3">
            <input type="text" class="form-control" name="org_address" placeholder="Address" required>
          </div>
          <div class="mb-3">
            <input type="text" class="form-control" name="org_tin" placeholder="TIN Number" required>
          </div>
          <hr>
          <h6 class="mb-3 text-light">Manager Details</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <input type="text" class="form-control" name="manager_first_name" placeholder="First Name" required>
            </div>
            <div class="col-md-6 mb-3">
              <input type="text" class="form-control" name="manager_last_name" placeholder="Last Name" required>
            </div>
          </div>
          <div class="mb-3">
            <input type="email" class="form-control" name="manager_email" placeholder="Email" required>
          </div>
          <div class="mb-3">
            <input type="text" class="form-control" name="manager_contact" placeholder="Contact" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" name="password" placeholder="Password" required>
          </div>
          <div class="mb-3">
            <input type="password" class="form-control" name="confirm_password" placeholder="Confirm Password" required>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Add Organization</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border-0">
      <form method="POST" action="{{ url_for('change_password') }}">
        <div class="modal-header border-0">
          <h5 class="modal-title text-light" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="user_id" value="{{ user.id }}">
          <div class="mb-3">
            <label class="form-label text-light small">Current Password</label>
            <input type="password" class="form-control" name="current_password" placeholder="Enter current password" required>
          </div>
          <div class="mb-3">
            <label class="form-label text-light small">New Password</label>
            <input type="password" class="form-control" name="new_password" placeholder="Enter new password" required>
          </div>
          <div class="mb-3">
            <label class="form-label text-light small">Confirm Password</label>
            <input type="password" class="form-control" name="confirm_password" placeholder="Confirm new password" required>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Update Password</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border-0">
      <form method="POST" action="{{ url_for('edit_profile') }}">
        <div class="modal-header border-0">
          <h5 class="modal-title text-light" id="editProfileModalLabel">Edit Profile</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="user_id" value="{{ user._id }}">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label text-light small">First Name</label>
              <input type="text" class="form-control" name="first_name" value="{{ user.first_name }}" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label text-light small">Last Name</label>
              <input type="text" class="form-control" name="last_name" value="{{ user.last_name }}" required>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label text-light small">Email</label>
            <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
          </div>
          <div class="mb-3">
            <label class="form-label text-light small">Contact</label>
            <input type="text" class="form-control" name="contact" value="{{ user.contact }}">
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}